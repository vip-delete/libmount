let ns;
class aa{constructor(a){this.name=a}warn(){}};class ba{decode(a){return(new TextDecoder("UTF-16")).decode(new Uint16Array(a))}encode(a){const b=a.length,c=new Uint8Array(b);for(let d=0;d<b;d++){const e=a.charCodeAt(d);c[d]=e<256?e:63}return c}}const ca=new ba;const p=a=>new Uint8Array([...a].map(b=>b.charCodeAt(0))),da=p(" $%'-_@~`!(){}^#&"),ha=p(".+,;=[]"),ia=a=>{let b=a[0];for(let c=1,d=a.length;c<d;c++)b=(b<<7|b>>1)+a[c]&255;return b},q=a=>a>127||a>64&&a<91||a>47&&a<58||da.includes(a),ja=a=>{let b=0;for(;b<a.length&&a.charCodeAt(b)===32;)b++;let c=a.length-1,d;for(;c>=b&&((d=a.charCodeAt(c))===32||d===46);)c--;return a.slice(b,c+1)},ka=a=>{const b=[];a=a.split(/[/\\]/u);for(let d=0;d<a.length;d++){var c=a[d].trim();c!==""&&c!=="."&&(c===".."?b.length&&
b.length--:(c=ja(c),c!==""&&b.push(c)))}return b},la=(a,b)=>{b=b.decode(a);a=b.slice(0,8).trimEnd();b=b.slice(8,11).trimEnd();return b===""?a:a+"."+b},ma=(a,b,c,d,e)=>{if(e.startsWith(" ")||e.endsWith(" "))return!1;let f=0;d=d.encode(e);if(d.length>c)return!1;for(;f<d.length;){e=d[f];if(!q(e))return!1;a[b+f]=e;f++}for(;f<c;)a[b+f]=32,f++;return!0},na=(a,b)=>{var c=a.lastIndexOf(".");const d=c<0?a:a.substring(0,c);a=c<0?"":a.substring(c+1);if(d===""&&a==="")return null;c=new Uint8Array(11);return ma(c,
0,8,b,d)&&ma(c,8,3,b,a)?c:null},t=new Uint8Array(520),u=new Uint16Array(260),oa=a=>{let b=0,c=a.length-1,d;do{var e=a[c--],f=e.ta;let g=0;for(;g<10&&(d=f[g++]|f[g++]<<8);)u[b++]=d;if(d){f=e.ua;for(g=0;g<12&&(d=f[g++]|f[g++]<<8);)u[b++]=d;if(d)for(e=e.va,g=0;g<4&&(d=e[g++]|e[g++]<<8);)u[b++]=d}}while(d&&c>=0);return String.fromCharCode(...u.subarray(0,b))},pa=(a,b,c)=>{let d="",e=0,f=0;for(;e<a.length&&f<b;){const g=a.charAt(e);if(d!==""||g!==" "){const l=c.encode(g),h=l[0];h!==63&&(q(h)?(d+=g,f+=
l.length):(d+="_",f++))}e++}return d},qa=(a,b,c)=>{a=a.toUpperCase();var d=a.lastIndexOf("."),e=d<0?"":a.substring(d+1);d=pa(d<0?a:a.substring(0,d),6,b);b=pa(e,3,b);if(d.length>2)a=d;else{e=0;for(let f=0;f<a.length;f++)e=e+a.charCodeAt(f)&65535;a=e.toString(16).padStart(4,"0").toUpperCase();a=d+a}d=b===""?"":"."+b;for(e=b=1;e<=7;){e=a.substring(0,7-e)+"~"+b+d;if(!c.has(e))return e;b++;e=b.toString().length}return""},ra=(a,b,c)=>a?new Date(1980+(a>>9&127),Math.max(0,(a>>5&15)-1),Math.max(1,a&31),b>>
11&31,b>>5&63,Math.floor(c/100)+((b&31)<<1),c%100*10):null,v=a=>a?a.getFullYear()-1980<<9|a.getMonth()+1<<5|a.getDate():0,w=a=>a?a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1:0;const sa=[235,60,144],wa=[235,88,144],xa=p("¬æV|¬¥¬¨¬Ñ√Ät√ç√´√∑1√Ä√ç√ç√´√æ"),ya=p("¬ær|¬¥¬¨¬Ñ√Ät√ç√´√∑1√Ä√ç√ç√´√æ");function x(a,b){a.i=b;return a}function A(a,b){a.i+=b;return a}function B(a,b){return new Uint8Array(a.g.subarray(a.i,a.i+=b))}function C(a){return a.g[a.i++]}function D(a){const b=a.g;return b[a.i++]|b[a.i++]<<8}function E(a){const b=a.g;return(b[a.i++]|b[a.i++]<<8|b[a.i++]<<16|b[a.i++]<<24)>>>0}function F(a,b){a.g.set(b,a.i);a.i+=b.length;return a}function G(a,b){a.g[a.i++]=b;return a}function H(a,b){a.g.fill(0,a.i,a.i+=b);return a}
function J(a,b){const c=a.g;c[a.i++]=b;c[a.i++]=b>>>8;return a}function N(a,b){const c=a.g;c[a.i++]=b;b>>>=8;c[a.i++]=b;b>>>=8;c[a.i++]=b;c[a.i++]=b>>>8;return a}class O{constructor(a){this.g=a;this.i=0}};const za=a=>{const b=C(a),c=C(a);a=C(a);return{pa:c>>6<<8|a,Ja:b,Ka:c&63}},Aa=(a,b)=>{const c=b.pa>>8<<6|b.Ka&63,d=b.pa&255;G(G(G(a,b.Ja),c),d)},Ba=a=>{x(a,446);const b=[];for(let c=0;c<4;c++){let d={ca:C(a),La:za(a),ia:C(a),Ha:za(a),xa:E(a),ka:E(a)};try{if(!(d.ia>0))throw Error();if(![0,128].includes(d.ca))throw Error();if(!(d.ka>0))throw Error();}catch{d=null}d&&b.push(d)}return b},Ca=(a,b)=>{x(a,446);let c=0;for(;c<4&&c<b.length;){const d=b[c];G(a,d.ca);Aa(a,d.La);G(a,d.ia);Aa(a,d.Ha);N(a,d.xa);
N(a,d.ka);c++}H(a,(4-c)*16);J(a,43605)},Da=a=>{a={D:B(a,11),G:C(a),ga:C(a),J:C(a),I:D(a),H:D(a),K:D(a),C:D(a),M:D(a),L:D(a),v:D(a),u:E(a)};a.D[0]===5&&(a.D[0]=229);return a},S=(a,b,c)=>{c.D[0]===229&&(c.D[0]=5);N(J(J(J(J(J(J(J(G(G(G(F(x(a,b),c.D),c.G),c.ga),c.J),c.I),c.H),c.K),c.C),c.M),c.L),c.v),c.u)},Ea=a=>{const b=new Date;return{D:a,G:8,ga:0,J:0,I:0,H:0,K:0,C:0,M:w(b),L:v(b),v:0,u:0}},Fa=(a,b)=>({D:a,G:16,ga:0,J:b.J,I:b.I,H:b.H,K:b.K,C:b.C,M:b.M,L:b.L,v:b.v,u:0}),Ga=(a,b)=>{const c=v(b),d=w(b);
return{D:a,G:0,ga:0,J:b?Math.floor((b.getSeconds()%2*1E3+Number(b.getMilliseconds()))/10):0,I:d,H:c,K:c,C:0,M:d,L:c,v:0,u:0}};const T=new aa("FS"),U=(a,b,c,d)=>{const e=a===0,f=a===3,g=a===4;return{ma:b,N:c,m:d,B:d.C<<16|d.v,W:e,Ua:a===1,la:f,ba:g,Ea:e||f,Fa:f||g,cb:a===5,Va:a===6,F:b,V:c,Da:1}},Ha=Ga(new Uint8Array(11),null),Ia=U(0,"",0,Ha),Ja=p(".          "),Ka=p("..         "),La=(a,b)=>{a=a.toUpperCase();return a===b.ma||a===b.F.toUpperCase()},Ma=(a,b,c)=>{if(b.length)if((b[b.length-1].T&63)===1){const d=ia(a.m.D);b.every(e=>e.oa===d)?(a.F=oa(b),a.V=c,a.Da=b.length+1):T.warn(`Skip invalid chainLFN at ${c}: chksum mismatch`)}else T.warn(`Skip invalid chainLFN at ${c}: chain is not finished`)};
class Na{constructor(a){this.h=a}g(a){const b=this.h,c=D(x(b.h,b.l[0]+a+(a>>1)));return a&1?c>>4:c&b.g.fa}j(a,b){const c=this.h;for(let d=0;d<c.l.length;d++){const e=D(x(c.h,c.l[d]+a+(a>>1)));J(A(c.h,-2),a&1?b<<4|e&15:e&61440|b)}}l(){return 2}o(){}}class Oa{constructor(a){this.h=a}g(a){const b=this.h;return D(x(b.h,b.l[0]+a*2))}j(a,b){const c=this.h;for(let d=0;d<c.l.length;d++)J(x(c.h,c.l[d]+a*2),b)}l(){return 2}o(){}}
class Pa{constructor(a){this.h=a;this.Y=this.h.bs.A.O*this.h.bs.A.qa;this.X=this.Y+492;x(this.h.h,this.Y);var b=this.h.h;a=E(b);const c=E(A(b,480));E(b);E(b);b=E(A(b,12));if(a!==1096897106||c!==1631679090||b!==2857697280)throw Error();}g(a){const b=this.h;return E(x(b.h,b.l[0]+a*4))&b.g.fa}j(a,b){const c=this.h;for(let d=0;d<c.l.length;d++){const e=E(x(c.h,c.l[d]+a*4));N(A(c.h,-4),e&4026531840|b)}}l(){const a=this.h,b=E(x(a.h,this.X));return b>=2&&b<=a.g.R?b:2}o(a){N(x(this.h.h,this.X),a)}}
function Qa(a,b){const c=a.h.N,d=a.h.m;a.h.B=b;J(x(J(x(a.l.h,c+20),d.C=b>>>16),c+26),d.v=b&65535)}
class Za{constructor(a,b){this.l=a;this.Y=a.g.aa;this.h=b;this.o=0;this.g=b.B;this.X=this.j=0}rewind(){this.o=0;this.g=this.h.B;this.X=this.j=0}skipClus(){const a=this.l,b=this.Y;let c=Math.min(b,Math.max(0,this.h.m.u-this.j));c&&(this.g>=2&&this.g<=a.g.R?(this.o=this.g,this.g=a.j.g(this.g),this.j+=b):c=0);return c}readClus(a){const b=this.l,c=this.Y;let d=Math.min(c,Math.max(0,this.h.m.u-this.j));if(d){var e=V(b,this.g);if(e){var f=a.set;e=x(b.h,e);f.call(a,e.g.subarray(e.i,e.i+d));this.o=this.g;
this.g=b.j.g(this.g);this.j+=c}else d=0}return d}writeClus(a){const b=this.l,c=this.Y,d=this.h,e=Math.min(c,a.length);var f=V(b,this.g);if(!f){f=$a(b);if(!f)return 0;d.B?b.j.j(this.o,f):Qa(this,f);this.g=f;f=V(b,f);d.m.u=this.j+e;N(x(b.h,d.N+28),d.m.u)}F(x(b.h,f),a.subarray(0,e));this.X=this.j+e;this.o=this.g;this.g=b.j.g(this.g);this.j+=c;return e}readData(){this.rewind();var a=this.h.m.u;const b=new Uint8Array(a);if(a){let c=b;for(;a=this.readClus(c);)c=c.subarray(a)}return b}writeData(a){this.rewind();
let b,c=a;for(;c.length&&(b=this.writeClus(c));)c=c.subarray(b);ab(this.l,this.g);this.h.B===this.g&&Qa(this,0);this.h.m.u=this.X;N(x(this.l.h,this.h.N+28),this.h.m.u);return a.length-c.length}}function bb(a,b,c){let d=a.g;b=ka(b);const e=[];let f=0;for(;f<b.length&&d;)(d=c(d,b[f],f===b.length-1))&&e.push(d.F),f++;return d?new cb(a.h,(a.g.W?"":a.j)+"/"+e.join("/"),d):null}function db(a,b,c){return bb(a,b,(d,e,f)=>eb(a.h,d,e,c&&f))}
function fb(a,b){if(a.g.ba)return 0;const c=ka(a.j);b=ka(b);var d=a.h.root,e=d;for(a=0;;){if(a===c.length)return 1;if(a===b.length)return 0;const f=c[a],g=b[a];d=d.findFirst(l=>La(f,l.g));e=e.findFirst(l=>La(g,l.g));if(!d||!e||d.g.V!==e.g.V)return 0;a++}}
class cb{constructor(a,b,c){this.h=a;this.j=b;this.g=c}getName(){return this.g.F}getShortName(){return this.g.ma}getAbsolutePath(){return this.j}isRegularFile(){return this.g.ba}isDirectory(){return this.g.Ea}length(){const a=this.listFiles();if(a){let b=0;for(let c=0;c<a.length;c++)b+=a[c].length();return b}return this.g.m.u}getSizeOnDisk(){const a=this.h,b=this.g;let c=0;gb(a,b,d=>{c+=hb(a,d.B)});b.W&&(c+=hb(a,ib(a,a.g.ha)));return c*a.g.aa}getLastModified(){const a=this.g.m;return ra(a.L,a.M,0)}setLastModified(a){const b=
this.g.m;J(J(x(this.h.h,this.g.N+22),b.M=w(a)),b.L=v(a))}getCreationTime(){const a=this.g.m;return ra(a.H,a.I,a.J)}setCreationTime(a){const b=this.g.m;J(J(G(x(this.h.h,this.g.N+13),b.J=a?Math.floor((a.getSeconds()%2*1E3+Number(a.getMilliseconds()))/10):0),b.I=w(a)),b.H=v(a))}getLastAccessTime(){var a=this.g.m.K;return a?new Date(1980+(a>>9&127),Math.max(0,(a>>5&15)-1),Math.max(1,a&31)):null}setLastAccessTime(a){const b=this.g.m;J(x(this.h.h,this.g.N+18),b.K=v(a))}findFirst(a){let b=null;return jb(this.h,
this.g,c=>a(b=new cb(this.h,(this.g.W?"":this.j)+"/"+c.F,c)))?b:null}findAll(a){if(!this.g.Ea)return null;const b=[];this.findFirst(c=>{a(c)&&b.push(c);return!1});return b}listFiles(){return this.findAll(()=>!0)}open(){return this.g.ba?new Za(this.h,this.g):null}delete(){var a=this.g;const b=this.h;gb(b,a,c=>{ab(b,c.B);kb(this.h,c)});if(a.W&&(a=ib(b,b.g.ha))){const c=this.h.getLabel();ab(b,a);lb(b,a);b.j.j(a,this.h.g.fa);this.h.setLabel(c)}}getFile(a){return bb(this,a,(b,c)=>jb(this.h,b,d=>La(c,d)))}makeFile(a){return db(this,
a,!0)}makeDir(a){return db(this,a,!1)}moveTo(a){const b=this.g;if(b.W)return null;a.startsWith("/")||a.startsWith("\\")||(a=this.j.substring(0,this.j.length-b.F.length)+a);if(fb(this,a))return null;var c=this.h.root.getFile(a);if(c&&c.g.ba)return null;var d=!b.la;a=c?db(c,b.F,d):db(this.h.root,a,d);if(!a)return null;c=a.g;if(b.V===c.V)return a;ab(this.h,c.B);d=b.m;const e=c.m;c.B=b.B;e.J=d.J;e.I=d.I;e.H=d.H;e.K=d.K;e.C=d.C;e.M=d.M;e.L=d.L;e.v=d.v;e.u=d.u;S(this.h.h,c.N,e);kb(this.h,b);return a}}
function V(a,b){return b>=2&&b<=a.g.R?a.bs.A.O*(a.g.ra+(b-2)*a.bs.A.$):0}function $a(a){const b=a.j.l();let c=b;for(;c<=a.g.R&&a.j.g(c)!==0;)c++;if(c>a.g.R){for(c=2;c<b&&a.j.g(c)!==0;)c++;if(c>=b)return 0}a.j.o(c+1);a.j.j(c,a.g.fa);return c}function ab(a,b){for(;b>=2&&b<=a.g.R;){const c=a.j.g(b);a.j.j(b,0);b=c}}function gb(a,b,c){let d=mb(a,b);for(;d;){const e=nb(a,d);d.Fa&&gb(a,d,c);d=e}b.Fa&&c(b)}function hb(a,b){let c=0;for(;b>=2&&b<=a.g.R;)c++,b=a.j.g(b);return c}
function ib(a,b){b=Math.floor(b/a.bs.A.O)-a.g.ra;return b<0?0:2+Math.floor(b/a.bs.A.$)}function jb(a,b,c){return ob(a,b,d=>d.Fa&&c(d))}function kb(a,b){const c=a.h;let d=0,e=b.V;do G(x(c,e),229);while(++d<b.Da&&(e=Y(a,e+32)))}function lb(a,b){b=V(a,b);H(x(a.h,b),a.g.aa);return b}
function eb(a,b,c,d){if(!b.Ea)return T.warn(`'${b.F}' is not a directory`),null;c=ja(c);if(!c||c.length>255)return null;const e=new Set,f=c.toUpperCase();var g=jb(a,b,m=>{var k=m.ma.toUpperCase();e.add(k);k=f===k;k||(k=m.F.toUpperCase(),e.add(k),k=f===k);return k});if(g)return g.ba&&d||g.la&&!d?g:null;g=a.o;let l=c,h=na(l,g);h||c===(l=l.toUpperCase())||(h=na(l,g));h||=na(l=qa(c,g,e),g);var n;h?n=pb(a,b,d,l,c,h):n=null;return n}function qb(a){return ob(a,Ia,b=>b.Ua)}
function rb(a,b,c){let d=0,e=0;var f=a.h,g=a.g.ha;b.la&&(g=V(a,b.B));for(b=g;g;){b=g;const l=C(x(f,g));if(l===0||l===229){if(e===0&&(d=g),e++,e>=c)return d}else e=0;g=Y(a,g+32)}f=ib(a,b);if(!f)return 0;g=Math.ceil((c-e)*32/a.g.aa);c=$a(a);if(!c)return 0;lb(a,c);a.j.j(f,c);if(g===2){f=$a(a);if(!f)return 0;lb(a,f);a.j.j(c,f)}return e>0?d:V(a,c)}function ob(a,b,c){for(b=mb(a,b);b&&!c(b);)b=nb(a,b);return b}function mb(a,b){return b.W?sb(a,a.g.ha):b.la&&(b=V(a,b.B))?sb(a,b):null}
function nb(a,b){b=b.N;return b>0&&(b=Y(a,b+32))?(a=sb(a,b),a?.Va?null:a):null}
function pb(a,b,c,d,e,f){const g=[];if(e!==d){a:{for(var l=0,h=0;l<e.length;){var n=e.charCodeAt(l++);var m=n;if(!(m>255||m>96&&m<123||q(m)||ha.includes(m))){m=null;break a}t[h++]=n;n>>=8;t[h++]=n}if(h%26!==0)for(t[h++]=0,t[h++]=0;h%26!==0;)t[h++]=255,t[h++]=255;m=t.subarray(0,h)}if(!m)return null;l=ia(f);for(h=0;h<m.length;)g.push({T:1+g.length,ta:m.subarray(h,h+=10),G:15,Oa:0,oa:l,ua:m.subarray(h,h+=12),v:0,va:m.subarray(h,h+=4)});m=g[g.length-1];m.T|=64}m=g.length+1;l=rb(a,b,m);if(!l)return null;
h=a.h;f=Ga(f,new Date);if(!c){n=$a(a);if(!n)return null;var k=lb(a,n);f.v=n&65535;f.C=n>>>16;f.G=16;S(h,k,Fa(Ja,f));S(h,k+32,Fa(Ka,b.m))}b=l;n=g.length;for(let r=0;r<n;r++)k=g[n-1-r],F(J(F(G(G(G(F(G(x(h,b),k.T),k.ta),k.G),k.Oa),k.oa),k.ua),k.v),k.va),b=Y(a,b+32);S(h,b,f);a=U(c?4:3,d,b,f);a.F=e;a.V=l;a.Da=m;return a}function Y(a,b){var c=a.bs.A.O;const d=a.bs.A.$;var e=a.g.ra;if(b%c!==0)return b;c=b/c;if(c<e)return b;if(c===e)return 0;e=c-e;if(e%d!==0)return b;b=a.j.g(1+e/d);return V(a,b)}
function sb(a,b){a:{const d=a.h,e=[];let f=b;for(;f;){var c=C(x(d,f));A(d,-1);if(c=c!==0&&c!==229)c=C(A(d,11))===15,A(d,-12);if(c)c={T:C(d),ta:B(d,10),G:C(d),Oa:C(d),oa:C(d),ua:B(d,12),v:D(d),va:B(d,4)},c.T&64?(e.length&&T.warn(`Skip invalid chainLFN at ${b}: new chain started`),e.length=0,e.push(c)):e.length?(e[e.length-1].T&63)===(c.T&63)+1?e.push(c):(T.warn(`Skip invalid chainLFN at ${b}: order mismatch`),e.length=0):T.warn(`Skip invalid dirLFN at ${f}: chain is empty`);else{if(c=tb(a,f)){Ma(c,
e,b);a=c;break a}T.warn(`Skip invalid node at ${f}`)}f=Y(a,f+32)}a=null}return a}function tb(a,b){var c=a.h;a=a.o;var d=C(x(c,b));A(c,-1);if(d===0)return U(6,"",b,Ha);if(d===229)return U(5,"",b,Ha);c=Da(c);d=c.D;var e=c.G;return(e&8)>0?U(1,a.decode(d).trimEnd(),b,c):(e=(e&16)>0)&&d.every((f,g)=>f===Ja[g])?U(2,".",b,c):e&&d.every((f,g)=>f===Ka[g])?U(2,"..",b,c):d.every(q)&&(a=la(d,a))&&!a.startsWith(" ")?U(e?3:4,a,b,c):null}
class ub{constructor(a,b){this.h=a;this.o=b;x(a,0);b=B(a,3);var c=B(a,8),d={O:D(a),$:C(a),U:D(a),S:C(a),Aa:D(a),Ma:D(a),sa:C(a),ea:D(a),Ca:D(a),wa:D(a),ab:E(a),Na:E(a),Ia:-1,Pa:-1,Qa:-1,ya:-1,qa:-1,Ga:-1};if(![512,1024,2048,4096].includes(d.O))throw Error();if(![1,2,4,8,16,32,64,128].includes(d.$))throw Error();if(!(d.U>0))throw Error();if(!(d.S>0))throw Error();if((d.Aa<<5)%d.O!==0)throw Error();if(!(d.Aa===0||d.ea>0))throw Error();if(!(d.Ma>0||d.Na>65535))throw Error();if(d.ea===0){d.Ia=E(a);d.Pa=
D(a);d.Qa=D(a);d.ya=E(a);d.qa=D(a);d.Ga=D(a);A(a,12);if(!(d.ya>=2))throw Error();if(!(d.Ga>=0))throw Error();if(!(d.qa>0))throw Error();}this.bs={eb:b,Ra:c,A:d,Za:C(a),bb:C(a),Xa:C(a),Sa:E(a),Ta:B(a,11),$a:B(a,8),Wa:B(a,510-a.i)};var e=this.bs.A;a=e.ea===0;b=e.O;c=e.$;d=e.U;const f=e.S;var g=e.Aa,l=e.Ma,h=e.ea,n=e.Na,m=e.Ia;e=e.ya;g=a?0:Math.ceil((g<<5)/b);h=a?m:h;l=l?l:n;n=l-(d+h*f+g);m=Math.floor(n/c);const k=a?32:m<4087?12:16;d+=h*f;this.g={Z:h,ja:l,Ya:n,aa:b*c,da:m,P:k,R:m+1,ra:d+g,ha:b*(d+(a?
(e-2)*c:0)),fa:(1<<Math.min(28,k))-1};this.root=new cb(this,"/",Ia);this.l=Array(this.bs.A.S);for(a=0;a<this.bs.A.S;a++)this.l[a]=(this.bs.A.U+a*this.g.Z)*this.bs.A.O;if(this.g.P===12)a=new Na(this);else if(this.g.P===16)a=new Oa(this);else if(this.g.P===32)a=new Pa(this);else throw Error();this.j=a}getName(){return"FAT"+this.g.P}getLabel(){return qb(this)?.ma??this.o.decode(this.bs.Ta).trimEnd()}setLabel(a){var b=qb(this);if(a){var c=this.o;const d=(new Uint8Array(11)).fill(32);a&&d.set(c.encode(a.substring(0,
11)).subarray(0,11));a=Ea(d);(b=b?.N??rb(this,Ia,1))&&S(this.h,b,a)}else b&&kb(this,b)}getOEMName(){return this.o.decode(this.bs.Ra).trimEnd()}getId(){return this.bs.Sa}getSizeOfCluster(){return this.g.aa}getCountOfClusters(){return this.g.da}getFreeClusters(){let a=0;for(let b=2;b<=this.g.R;b++)this.j.g(b)===0&&a++;return a}getRoot(){return this.root}};const vb=new aa("DISK");
class wb{constructor(a,b){this.g=a;this.h=b}capacity(){return this.g.g.length}getFileSystem(){let a=null;try{a=new ub(this.g,this.h)}catch(b){T.warn("No FileSystem",b)}return a}getPartitions(){let a=[];try{a=Ba(this.g).map(({ca:b,ia:c,xa:d,ka:e})=>({active:b===128,type:c,relativeSectors:d,totalSectors:e}))}catch(b){vb.warn("No partition table",b)}return a}write(a){const b=this.g,c=a.bytsPerSec,d=a.zeroRegions;a=a.dataSectors;for(const {i:e,count:f}of d)H(x(b,c*e),c*f);for(const {i:e,data:f}of a)F(x(b,
c*e),f)}};const xb=p("LIBMNTJS"),yb=p("Non-system disk or disk error\r\nreplace and strike any key when ready\r\n"),zb=p("NO NAME    "),Ab=new Map([[160,[254,40,1,8,0,1,4]],[180,[252,40,1,9,0,2,4]],[320,[255,40,2,8,1,1,7]],[360,[253,40,2,9,1,2,7]],[720,[249,80,2,9,1,3,7]],[1200,[249,80,2,15,0,7,14]],[1440,[240,80,2,18,0,9,14]],[2880,[240,80,2,36,1,9,15]]]),Z=(a,b,c,d)=>Number.isInteger(d)&&(d=Number(d),d>=a&&d<=b)?d:c,Bb=(a,b)=>{a+=2;let c=12;b===32?c-=5:b===16?c-=4:(a*=3,c-=2);return(a>>>c)+((a&(1<<c)-1)===
0?0:1)},Cb=(a,b)=>{var c=Number.MAX_SAFE_INTEGER;c=a=Z(0,c,c,a);var d=b?.type,e=32;d==="FAT12"?e=12:d==="FAT16"?e=16:d==="FAT32"?e=32:c<=4194304?e=12:c<536870912&&(e=16);c=e;d=Math.min(4294967295,Math.floor(a/512));a=b?.numFATs===1?1:2;e=0;let f=32;c!==32&&(e=Z(1,512,512,b?.rootEntCnt),e=(e>>4)+((e&15)===0?0:1),f=1);var g=1,l=268435438;c===12?(g=0,l=4078):c===16&&(g=4087,l=65518);var h=d-f-e;if(h<a)return null;var n=Z(0,16,16,b?.compat);g+=n;l-=n;a:{n=l;b=b?.secPerClus;if(Number.isInteger(b)&&(b=
[1,2,4,8,16,32,64,128].indexOf(Number(b)),b>=0))break a;if(c===32)b=d<=532480?0:3;else{b=Bb(n,c);b=h-a*b;for(var m=0;m<6&&n<b;)m++,n*=2;b=m}}m=1<<b;n=Math.ceil((h+(1<<b+1))/((1<<b+9+3)/c+a));h=Math.floor((h-n*a)/m);if(h<g)return null;h>l&&(h=l);n=Bb(h,c);var k=f+n*a+e;l=d-(k+h*m);k%=m;k=k===0?0:m-k;let r=0;if(k>l){h--;l+=m;if(h<g)return null;g=Bb(h,c);r=(n-g)*a;n=g}d-=l-k;return{P:c,na:9,Ba:b,U:f+(k+r),S:a,za:e,Z:n,ja:d,da:h,sa:248,wa:255,Ca:63}};ns={fdisk:a=>{const b=new Uint8Array(512);Ca(new O(b),a.map(({active:c,type:d,relativeSectors:e,totalSectors:f})=>{const g={pa:0,Ja:0,Ka:0};return{ca:c?128:0,La:g,ia:d,Ha:g,xa:e,ka:f}}));return{bytsPerSec:512,zeroRegions:[],dataSectors:[{i:0,data:b}]}},mkfsvfat:(a,b)=>{var c=Ab.get(a/1024);if(c){const [Db,Eb,Ra,Sa,Ta,Ua,Va]=c;a=Eb*Ra*Sa;a={P:12,na:9,Ba:Ta,U:1,S:2,za:Va,Z:Ua,ja:a,da:a-(1+Ua*2+Va)>>Ta,sa:Db,wa:Ra,Ca:Sa}}else a=Cb(a,b);var d=a;if(!d)return null;a=d.P;c=d.na;const e=d.Ba,f=d.U,g=d.S,
l=d.za,h=d.Z,n=d.ja,m=d.da;var k=d.P,r=d.na,P=d.Ba,Q=d.U,K=d.S,z=d.Z,L=d.ja,R=k===32,y=R?420:448;const M=1<<r;r=d.za<<r-5;var W=new Uint8Array(3),Wa=(new Uint8Array(8)).fill(32),X=new Date;P=1<<P;var ta=L>65535?0:L,Xa=Z(0,255,d.sa,b?.media),ua=R?0:z,Fb=Z(0,65535,d.Ca,b?.secPerTrk);d=Z(0,65535,d.wa,b?.numHeads);var Gb=Z(0,4294967295,0,b?.hiddSec),Ya=L>65535?L:0;L=Z(0,4294967295,(v(X)<<16|w(X))>>>0,b?.id);X=(new Uint8Array(8)).fill(32);var ea=new Uint8Array(y);Wa.set((b?.oemName??xb).subarray(0,8));
X.set(p("FAT"+k));if((k=b?.bs)&&k.length>=512)W.set(k.subarray(0,3)),ea.set(k.subarray(510-y,510));else{k=sa;var I=xa;y=510-y;R&&(k=wa,I=ya);W.set(k);ea.set(I);ea.set((b?.message??yb).subarray(0,509-y-I.length),I.length)}I=(k=a===32)?z:ua;y=Q+I*K+(k?0:Math.ceil((r<<5)/M));const Hb=Math.floor(((ta?ta:Ya)-y)/P);R=[];R.push({i:0,count:y+(k?P:0)});y=[];const va=new Uint8Array(M);var fa=new O(va);x(fa,0);const Ib=ua===0;N(N(J(J(J(G(J(J(G(J(G(J(F(F(fa,W),Wa),M),P),Q),K),r),ta),Xa),ua),Fb),d),Gb),Ya);Ib&&
A(J(J(N(J(J(N(fa,z),0),0),2),1),6),12);J(F(F(F(N(G(G(G(fa,0),0),41),L),zb),X),ea),43605);y.push({i:0,data:va});z=new Uint8Array(M);z[0]=Xa;for(r=0;r<a/4-1;r++)z[r+1]=255;k&&(z[8]=255,z[9]=255,z[10]=255,z[11]=15,r=new Uint8Array(M),W=Hb-1,N(H(N(N(N(H(N(new O(r),1096897106),480),1631679090),W),2),12),2857697280),y.push({i:1,data:r}),y.push({i:6,data:va}),y.push({i:7,data:r}));for(r=0;r<K;r++)y.push({i:Q+r*I,data:z});b?.label&&(z=new Uint8Array(M),Q=Q+I*K+(k?0*P:0),K=(new Uint8Array(11)).fill(32),K.set(b.label.subarray(0,
11)),S(new O(z),0,Ea(K)),y.push({i:Q,data:z}));return{sectors:{bytsPerSec:M,zeroRegions:R,dataSectors:y},id:L,type:"FAT"+a,totSec:n,rsvdSecCnt:f,numFATs:g,fatSz:h,rootDirSectors:l,countOfClusters:m,secPerClus:1<<e,bytsPerSec:1<<c}},mount:(a,b)=>{let c=0,d=a.length;const e=b?.partition;e&&(c=e.relativeSectors*512,d=c+e.totalSectors*512);return new wb(new O(a.subarray(c,d)),b?.codepage??ca)}};
export const {fdisk,mkfsvfat,mount}=ns;

